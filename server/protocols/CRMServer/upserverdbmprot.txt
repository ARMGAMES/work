
#include "../upserver/upservercommonprot.h"				// @no_thin_version
#include "../upserver/upservercommonprot_thin.h"		// @only_thin_version
#include "crmserver.h"

#define TOP_LEVEL_NAMESPACE UPServerDBM // overwrite the default top level namespace


MsgBodyStruct DBData @move_only_no_copy
{
	UPServerCommon::Property property;
	vector<UINT32> userIntIds; 
};


MsgBodyStruct IsUpdateAndPrevValidUntil @move_only_no_copy
{
	bool isUpdate;
	CommUtcTime validUntilPrev;
};

MsgBodyStruct DBDataIsUpdate @move_only_no_copy
{
	UPServerCommon::Property property;
	vector<UINT32> userIntIds;
	vector<IsUpdateAndPrevValidUntil> isUpdateForUserAndValidUntil;
	CommSrvTime when;
};

//------------------------------------------------------------------------------
// DBM save message
//------------------------------------------------------------------------------

 // #define CRMDBM_Q_UPS_SAVE_PROPERTY				857 // UPServer -> DBM
 // #define CRMDBM_A_UPS_SAVE_PROPERTY				1857 // DBM -> UPServer

Message CRMDBM_Q_UPS_SAVE_PROPERTY @move_only_no_copy
{
	DBDataIsUpdate dataRow;
};

Message CRMDBM_A_UPS_SAVE_PROPERTY @move_only_no_copy
{
	INT16 errCode;
	if( errCode )
	{
		PString errStr;
	}
};


//------------------------------------------------------------------------------
// DBM load all user properties 
//------------------------------------------------------------------------------

 // #define CRMDBM_Q_UPS_GET_DATA			858 // UPServer -> DBM
 // #define CRMDBM_A_UPS_GET_DATA			1858 // DBM -> UPServer

Message CRMDBM_Q_UPS_GET_DATA @move_only_no_copy
{
    
};

Message CRMDBM_A_UPS_GET_DATA @move_only_no_copy
{
	INT16 errCode;
	if( errCode )
	{
		PString errStr;
	}
	else
	{
       	vector< DBData > userPropertiesWithExpiry; // all properties found in db 
	}
};

