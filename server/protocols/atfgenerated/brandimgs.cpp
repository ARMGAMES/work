/**
 * brandimgs.cpp
 *
 * This file was auto-generated from brandimgs.txt by ATF protocol generator. 
 * Do not edit this file directly!
 *
 * Generator used the following keys: -genMoveConstructor brandimgs.txt
 */
 
#include "brandimgs.h"

//=================================================================
//                    AvatarImg
//=================================================================

BrandProt::AvatarImg::AvatarImg()
{
	clear();
}

void BrandProt::AvatarImg::clear()
{
	avatarGameType = 0;
	imageId = 0;
}

bool BrandProt::AvatarImg::equals(const AvatarImg& _o) const
{
	return avatarGameType == _o.avatarGameType &&
		imageId == _o.imageId;
}

const char *BrandProt::AvatarImg::toTraceString(PString& _buf) const
{
	_buf.append('{');
	_buf.append("avatarGameType=");
	_buf.appendInt(avatarGameType);
	_buf.append(',');
	_buf.append("imageId=");
	_buf.appendUint(imageId);
	_buf.append('}');
	return _buf.c_str();
}

const char *BrandProt::AvatarImg::toXmlString(const char *_element, PString& _buf) const
{
	_buf.append('<').append(_element).append('>');
	Atf::XmlElement::encodeAsXmlElement("avatarGameType", avatarGameType, _buf);
	Atf::XmlElement::encodeAsXmlElement("imageId", imageId, _buf);
	Atf::XmlElement::appendElementCloseTag(_element, _buf);
	return _buf.c_str();
}

bool BrandProt::AvatarImg::fromXmlString(const PString& _str)
{
	PString _element;
	PBlock _value;
	PString _type;
	const char* _xml = _str.c_str();
	
	while (Atf::XmlElement::decodeNextXmlElement(_xml, _str.length(), _element, _value, _type))
	{
		if (_element.equals("avatarGameType"))
		{
			avatarGameType = (INT16)p_atoi64((const char *)_value.ptr());
		}
		else if (_element.equals("imageId"))
		{
			imageId = (UINT32)p_atoi64((const char *)_value.ptr());
		}
		else
		{
			return false;  // unknown instance variable name
		}
	}
	return true;
}

void BrandProt::AvatarImg::composeMsg(CommMsgBody& _msg, bool _ignoreJSON) const
{
	CommMsgBody _body;
	//if (!equals(AvatarImg())) // not empty
	{
		_body.composeINT16(avatarGameType);
		_body.composeUINT32(imageId);
	}

	_msg.composeMsgBody(_body);
}

void BrandProt::AvatarImg::parseMsg(CommMsgParser& _parser)
{
	CommMsgBody _body;
	_parser.parseMsgBody(_body);

	CommMsgParser _parser0(_body);
	_parser0.parseINT16(avatarGameType);
	_parser0.parseUINT32(imageId);
}

const char *BrandProt::AvatarImg::toJSONString(PString& _buf) const
{
	Atf::JSONStringComposer _jsonstr(_buf);
	_jsonstr.compose("avatarGameType", avatarGameType);
	_jsonstr.compose("imageId", imageId);
	return _buf.c_str();
}

void BrandProt::AvatarImg::fromJSONString(const PString& _jsonString)
{
	Atf::JSONStringParser _jparser(_jsonString);
	_jparser.parseByNameThrow("avatarGameType", avatarGameType);
	_jparser.parseByNameThrow("imageId", imageId);
}

/* static */ void BrandProt::AvatarImg::validateJSONString(const PString& _jsonString, const AtfMsgChecker* _checker, const char* _descr, PString& _fieldsWithUnparsedContent)
{
	Atf::JSONStringValidatorWithChecker _jparser(_jsonString, _checker, _descr, _fieldsWithUnparsedContent);
	INT16 avatarGameType; _jparser.validateByNameThrow("avatarGameType", avatarGameType);
	AtfValidator::validateIntMax(_descr, "avatarGameType", avatarGameType, eAvatarGameType_Last, _checker, __FILE__, __LINE__);
	UINT32 imageId; _jparser.validateByNameThrow("imageId", imageId);
	AtfValidator::validateInt(_descr, "imageId", imageId, _checker, __FILE__, __LINE__);
}

/*static*/ void BrandProt::AvatarImg::validateMsg(CommMsgParser& _parser, const AtfMsgChecker* _checker, const char* _descr, PString& _fieldsWithUnparsedContent)
{
	AtfMsgBodyParserView _parser0(_parser);
	_parser.skipMsgBody();
	INT16 avatarGameType; _parser0.parseINT16(avatarGameType);
	AtfValidator::validateIntMax(_descr, "avatarGameType", avatarGameType, eAvatarGameType_Last, _checker, __FILE__, __LINE__);
	UINT32 imageId; _parser0.parseUINT32(imageId);
	AtfValidator::validateInt(_descr, "imageId", imageId, _checker, __FILE__, __LINE__);
	AtfValidator::validateEmbeddedMsgbodyParser(_descr, _parser0, _parser._shift(), __FILE__, __LINE__);
	if(!_parser0.parseEnded()) AtfValidator::logUnparsedInfo(_fieldsWithUnparsedContent, _descr, _parser0);
}

//=================================================================
//                    BrandImg
//=================================================================

BrandProt::BrandImg::BrandImg()
{
	clear();
}

#ifdef MOVE_CONSTRUCTOR_SUPPORTED

BrandProt::BrandImg::BrandImg(BrandImg&& _o)
	: brand(std::move(_o.brand))
	, imageId(std::move(_o.imageId))
	, avatars(std::move(_o.avatars))
{
}

BrandProt::BrandImg& BrandProt::BrandImg::operator=(BrandImg&& _o)
{
	if(this != &_o)
	{
		brand = std::move(_o.brand);
		imageId = std::move(_o.imageId);
		avatars = std::move(_o.avatars);
	}
	return *this;
}

#endif

void BrandProt::BrandImg::clear()
{
	brand = 0;
	imageId = 0;
	avatars.clear();
}

bool BrandProt::BrandImg::equals(const BrandImg& _o) const
{
	return brand == _o.brand &&
		imageId == _o.imageId &&
		avatars.equals(_o.avatars);
}

const char *BrandProt::BrandImg::toTraceString(PString& _buf) const
{
	_buf.append('{');
	_buf.append("brand=");
	_buf.appendUint(brand);
	_buf.append(',');
	_buf.append("imageId=");
	_buf.appendUint(imageId);
	_buf.append(',');
	_buf.append("avatars=");
	avatars.toTraceString(_buf);
	_buf.append('}');
	return _buf.c_str();
}

const char *BrandProt::BrandImg::toXmlString(const char *_element, PString& _buf) const
{
	_buf.append('<').append(_element).append('>');
	Atf::XmlElement::encodeAsXmlElement("brand", brand, _buf);
	Atf::XmlElement::encodeAsXmlElement("imageId", imageId, _buf);
	avatars.toXmlString("avatars", _buf);
	Atf::XmlElement::appendElementCloseTag(_element, _buf);
	return _buf.c_str();
}

bool BrandProt::BrandImg::fromXmlString(const PString& _str)
{
	PString _element;
	PBlock _value;
	PString _type;
	const char* _xml = _str.c_str();
	
	while (Atf::XmlElement::decodeNextXmlElement(_xml, _str.length(), _element, _value, _type))
	{
		if (_element.equals("brand"))
		{
			brand = (UINT32)p_atoi64((const char *)_value.ptr());
		}
		else if (_element.equals("imageId"))
		{
			imageId = (UINT32)p_atoi64((const char *)_value.ptr());
		}
		else if (_element.equals("avatars"))
		{
			if(!Atf::AtfTempl< Atf::LAtfVector< AvatarImg, 4 > >::FromXmlString(_value, avatars)) return false;
		}
		else
		{
			return false;  // unknown instance variable name
		}
	}
	return true;
}

void BrandProt::BrandImg::composeMsg(CommMsgBody& _msg, bool _ignoreJSON) const
{
	CommMsgBody _body;
	//if (!equals(BrandImg())) // not empty
	{
		_body.composeUINT32(brand);
		_body.composeUINT32(imageId);
		avatars.composeMsg(_body, _ignoreJSON);
	}

	_msg.composeMsgBody(_body);
}

void BrandProt::BrandImg::parseMsg(CommMsgParser& _parser)
{
	CommMsgBody _body;
	_parser.parseMsgBody(_body);

	CommMsgParser _parser0(_body);
	_parser0.parseUINT32(brand);
	_parser0.parseUINT32(imageId);
	if(_parser0.parseEnded()) return;
	avatars.parseMsg(_parser0);
}

const char *BrandProt::BrandImg::toJSONString(PString& _buf) const
{
	Atf::JSONStringComposer _jsonstr(_buf);
	_jsonstr.compose("brand", brand);
	_jsonstr.compose("imageId", imageId);
	_jsonstr.compose("avatars", avatars);
	return _buf.c_str();
}

void BrandProt::BrandImg::fromJSONString(const PString& _jsonString)
{
	Atf::JSONStringParser _jparser(_jsonString);
	_jparser.parseByNameThrow("brand", brand);
	_jparser.parseByNameThrow("imageId", imageId);
	if(_jparser.parseEnded()) return;
	_jparser.parseByNameThrow("avatars", avatars);
}

/* static */ void BrandProt::BrandImg::validateJSONString(const PString& _jsonString, const AtfMsgChecker* _checker, const char* _descr, PString& _fieldsWithUnparsedContent)
{
	Atf::JSONStringValidatorWithChecker _jparser(_jsonString, _checker, _descr, _fieldsWithUnparsedContent);
	UINT32 brand; _jparser.validateByNameThrow("brand", brand);
	AtfValidator::validateInt(_descr, "brand", brand, _checker, __FILE__, __LINE__);
	UINT32 imageId; _jparser.validateByNameThrow("imageId", imageId);
	AtfValidator::validateInt(_descr, "imageId", imageId, _checker, __FILE__, __LINE__);
	if(_jparser.parseEnded()) return;
	Atf::AtfVectorBase< AvatarImg > avatars; _jparser.validateByNameThrow("avatars", avatars);
	AtfValidator::validateInt(_descr, "avatars", avatars.size(), _checker, __FILE__, __LINE__);
}

/*static*/ void BrandProt::BrandImg::validateMsg(CommMsgParser& _parser, const AtfMsgChecker* _checker, const char* _descr, PString& _fieldsWithUnparsedContent)
{
	AtfMsgBodyParserView _parser0(_parser);
	_parser.skipMsgBody();
	UINT32 brand; _parser0.parseUINT32(brand);
	AtfValidator::validateInt(_descr, "brand", brand, _checker, __FILE__, __LINE__);
	UINT32 imageId; _parser0.parseUINT32(imageId);
	AtfValidator::validateInt(_descr, "imageId", imageId, _checker, __FILE__, __LINE__);
	if(_parser0.parseEnded()) return;
	PString _descbuf;
	int szAvatars = Atf::LAtfVector< AvatarImg, 4 >::validateMsg(_parser0, _checker, _descbuf.assign(_descr).append('.').append("avatars"), _fieldsWithUnparsedContent);
	AtfValidator::validateInt(_descr, "avatars", szAvatars, _checker, __FILE__, __LINE__);
	AtfValidator::validateEmbeddedMsgbodyParser(_descr, _parser0, _parser._shift(), __FILE__, __LINE__);
	if(!_parser0.parseEnded()) AtfValidator::logUnparsedInfo(_fieldsWithUnparsedContent, _descr, _parser0);
}

//=================================================================
//                    BrandImageList
//=================================================================

// @Override
size_t BrandProt::BrandImageList::size() const
{
	return images.size();
}

// @Override
void BrandProt::BrandImageList::addOrUpdate(UINT32 brand, UINT32 imageId)
{
	for(size_t i = 0; i < images.size(); ++i)
	{
		if(images[i].brand == brand)
		{
			images[i].imageId = imageId;
			return;
		}
	}

	BrandImg img;
	img.brand = brand;
	img.imageId = imageId;

	images.push_back(img);
}

// @Override
void BrandProt::BrandImageList::addAvatar(UINT32 brand, UINT32 avatarGameType, UINT32 imageId)
{
	for(size_t i = 0; i < images.size(); ++i)
	{
		if(images[i].brand == brand)
		{
			AvatarImg avatar;
			avatar.avatarGameType = static_cast< INT16 >( avatarGameType );
			avatar.imageId = imageId;
			images[i].avatars.push_back(avatar);
			return;
		}
	}
	
	BrandImg img;
	img.brand = brand;
	AvatarImg avatar;
	avatar.avatarGameType = static_cast< INT16 >( avatarGameType );
	avatar.imageId = imageId;
	img.avatars.push_back(avatar);
	images.push_back(img);
}

// @Override
UINT32 BrandProt::BrandImageList::getAvatar(UINT32 brand, INT16 avatarGameType) const
{
	UINT32 imageId = 0;

	if (avatarGameType != eAvatarGameType_Invalid)
	{
		for (auto&& image : images)
		{
			if (avatarGameType != eAvatarGameType_Undefined)
			{
				if (image.brand == brand)
				{
					for (auto&& avatar : image.avatars)
					{
						if (avatar.avatarGameType == avatarGameType)
							return avatar.imageId;
					}
				}
			}
			else if (image.imageId)
			{
				if (image.brand == brand)
					return image.imageId;

				imageId = image.imageId;
			}
		}
	}

	return imageId;
}

// @Override
void BrandProt::BrandImageList::compose(CommMsgBody& msg) const
{
	composeMsg(msg);
}

// @Override
void BrandProt::BrandImageList::parse(CommMsgParser& parser)
{
	parseMsg(parser);
}

// @Override
void BrandProt::BrandImageList::swap(BrandImageList& other)
{
	images.swap(other.images);
}

// @Override
void BrandProt::BrandImageList::composeMsgForPublication(bool hasShowImagePriv, UINT32 pokerStarsImageIdToBePublish, BrandImageList& brandImageList) const
{
	if( hasShowImagePriv )
	{
		if(size() == 0 && pokerStarsImageIdToBePublish != 0)
		{
			brandImageList.clear();
			brandImageList.addOrUpdate(BrandType_PokerStars, pokerStarsImageIdToBePublish);
		}
		else
		{
			
			brandImageList = *this;
		}
	}
	else  
	{
		if(size() == 0)
		{
			brandImageList = *this;
		}
		else
		{
			brandImageList.clear();
			
			
			for(size_t i = 0; i < images.size(); ++i)
			{
				if(images[i].brand == BrandType_FullTilt)
				{
					brandImageList.addOrUpdate(BrandType_FullTilt, images[i].imageId);
					break;
				}
			}
			
			for(size_t i = 0; i < images.size(); ++i)
			{
				auto&& currImg = images[i];
				for (size_t j = 0; j < currImg.avatars.size(); ++j)
				{
					brandImageList.addAvatar(currImg.brand, currImg.avatars[j].avatarGameType, currImg.avatars[j].imageId);
				}
			}
		}
	}		
}

// @Override
void BrandProt::BrandImageList::composeMsgForPublication(bool hasShowImagePriv, UINT32 pokerStarsImageIdToBePublish, CommMsgBody& body) const
{
	BrandImageList brandImageList;
	composeMsgForPublication(hasShowImagePriv, pokerStarsImageIdToBePublish, brandImageList);
	brandImageList.composeMsg(body);
}

BrandProt::BrandImageList::BrandImageList()
{
	clear();
}

#ifdef MOVE_CONSTRUCTOR_SUPPORTED

BrandProt::BrandImageList::BrandImageList(BrandImageList&& _o)
	: images(std::move(_o.images))
{
}

BrandProt::BrandImageList& BrandProt::BrandImageList::operator=(BrandImageList&& _o)
{
	if(this != &_o)
	{
		images = std::move(_o.images);
	}
	return *this;
}

#endif

void BrandProt::BrandImageList::clear()
{
	images.clear();
}

bool BrandProt::BrandImageList::equals(const BrandImageList& _o) const
{
	return images.equals(_o.images);
}

const char *BrandProt::BrandImageList::toTraceString(PString& _buf) const
{
	_buf.append('{');
	_buf.append("images=");
	images.toTraceString(_buf);
	_buf.append('}');
	return _buf.c_str();
}

const char *BrandProt::BrandImageList::toXmlString(const char *_element, PString& _buf) const
{
	_buf.append('<').append(_element).append('>');
	images.toXmlString("images", _buf);
	Atf::XmlElement::appendElementCloseTag(_element, _buf);
	return _buf.c_str();
}

bool BrandProt::BrandImageList::fromXmlString(const PString& _str)
{
	PString _element;
	PBlock _value;
	PString _type;
	const char* _xml = _str.c_str();
	
	while (Atf::XmlElement::decodeNextXmlElement(_xml, _str.length(), _element, _value, _type))
	{
		if (_element.equals("images"))
		{
			if(!Atf::AtfTempl< Atf::LAtfVector< BrandImg , 4 > >::FromXmlString(_value, images)) return false;
		}
		else
		{
			return false;  // unknown instance variable name
		}
	}
	return true;
}

void BrandProt::BrandImageList::composeMsg(CommMsgBody& _msg, bool _ignoreJSON) const
{
	CommMsgBody _body;
	//if (!equals(BrandImageList())) // not empty
	{
		images.composeMsg(_body, _ignoreJSON);
	}

	_msg.composeMsgBody(_body);
}

void BrandProt::BrandImageList::parseMsg(CommMsgParser& _parser)
{
	CommMsgBody _body;
	_parser.parseMsgBody(_body);

	CommMsgParser _parser0(_body);
	images.parseMsg(_parser0);
}

const char *BrandProt::BrandImageList::toJSONString(PString& _buf) const
{
	Atf::JSONStringComposer _jsonstr(_buf);
	_jsonstr.compose("images", images);
	return _buf.c_str();
}

void BrandProt::BrandImageList::fromJSONString(const PString& _jsonString)
{
	Atf::JSONStringParser _jparser(_jsonString);
	_jparser.parseByNameThrow("images", images);
}

/* static */ void BrandProt::BrandImageList::validateJSONString(const PString& _jsonString, const AtfMsgChecker* _checker, const char* _descr, PString& _fieldsWithUnparsedContent)
{
	Atf::JSONStringValidatorWithChecker _jparser(_jsonString, _checker, _descr, _fieldsWithUnparsedContent);
	Atf::AtfVectorBase< BrandImg > images; _jparser.validateByNameThrow("images", images);
	AtfValidator::validateInt(_descr, "images", images.size(), _checker, __FILE__, __LINE__);
}

/*static*/ void BrandProt::BrandImageList::validateMsg(CommMsgParser& _parser, const AtfMsgChecker* _checker, const char* _descr, PString& _fieldsWithUnparsedContent)
{
	AtfMsgBodyParserView _parser0(_parser);
	_parser.skipMsgBody();
	PString _descbuf;
	int szImages = Atf::LAtfVector< BrandImg , 4 >::validateMsg(_parser0, _checker, _descbuf.assign(_descr).append('.').append("images"), _fieldsWithUnparsedContent);
	AtfValidator::validateInt(_descr, "images", szImages, _checker, __FILE__, __LINE__);
	AtfValidator::validateEmbeddedMsgbodyParser(_descr, _parser0, _parser._shift(), __FILE__, __LINE__);
	if(!_parser0.parseEnded()) AtfValidator::logUnparsedInfo(_fieldsWithUnparsedContent, _descr, _parser0);
}

